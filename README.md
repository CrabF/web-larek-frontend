# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

### Архитектура приложения поделена на 3 слоя:

В работе используется паттерн проектирования MVP. 

Слой данных Model - хранит и обрабатывает данные, которые приходят от сервера. Основной используемый класс, который содержит все методы - AppData. У класса есть интерфейс IAppData - для типизации всех методов класса. AppData взаимодействует с основными интерфейсами из types.

Слой отображения View - занимается рендером карточек, модалок, форм и прочих визуальных элементов. Слой представляет собой отдельные классы:  Page, Card, Modal, Form, SuccessOrder, Basket. Слой отображает данные из Model при помощи событий слоя Presenter.

Слой Presenter - является связующим для слоя Model и View. Слой навешивает обработчики с помощью класса EventEmitter и через класс прослойку базового класса APi - LarekApi предоставляет информацию для слоя Model. Используется в основном файле index.ts.


#### Основные типы данных в types/index.ts

```typescript

// Интерфейс для отдельной карточки. Все данные, которые приходят с бэка, а также опциональное свойство selected - добавлен ли товар в корзину

export interface IProductItem {
  id: string; // уникальный идентификатор карточки 
  description: string; // описание карточки
  image: string; // изображение карточки
  title: string; // название карточки
  category: string; // название категориия карточки 
  price: number | null; // стоимость карточки товара. Стоимость может прийти нулевая
  selected?: boolean // опциональный параметр. Метка, сообщающая о том, что товар был выбран и помещен в корзину
}

// Интерфейс для корзины или главной страницы. Данные, которые приходят с бэка.

export interface IProductList {
  total: number; // общая стоимость карточек товаров - сумма price каждой карточки
  items: IProductItem[] // Массив карточек товаров
}

// Интерфейс для заказа. Информация, которую заполняет пользователь и затем отправляет на сервер вместе с выбранными товарами из корзины.

export interface IOrder {
  address: string; // адрес пользователя
  email: string; // почтовый адрес пользователя
  phone: string; // номер телефона пользователя
  payment: 'online' | 'cash'; // выбранный пользователем способ оплаты. В интерфейсе View - Онлайн или При получении
  total: number; // общая стоимость товаров - сумма price отдельных карточек
  items: string[] // массив с id конкретных карточек товаров, которые были выбраны и помещены в корзину
}

// Интерфейс для успешного заказа. После заполнения всех данных о пользователе и выборе товаров в корзину отправляется Post запрос на бэк с объектом типа IOrder. В ответ ожидается получить объект с информацией об успешном выполнении заказа

export interface IOrderSuccess {
  id: string; // уникальный идентификатор выполненного заказа
  total: number // общая стоимость всех карточек товаров, которые были отправлены на сервер
}

```

### Описание классов из слоя Model

Основной и единственный класс - **AppData**. Класс типизирован интерфейсом *IAppData*. Класс содержит все основные методы, требуемые для хранения и обработки информации, получаемой от сервера. Класс экспортируется и будет наследоваться в основном файле index.ts для взаимодействия с другими слоями.

**Переменные класса:**

Все переменные класса защищенные - *protected*, поэтому взаимодействие с переменными может быть лишь опосредованным через методы класса, описанные ниже.

Переменная *items* - инициализируется типом данных *IProductItem[]* - по умолчанию пустой массив []. Переменная сохранит в себе информацию о всех карточках товаров от сервера.

Переменная *order* - инициализируется типом данных *IOrder* - по умолчанию объект - 
 
 ```Javascript
 {
    address: '',
    email: '',
    phone: '',
    payment: 'online', // Дефолтное состояние способа оплаты
    total: 0, // общая стоимость карточек товаров
    items: []
  }

```

Переменная служит для сохранения всей информации о покупке карточек товаров пользователем и информации по оплате пользователя.

Переменная *basket* - инициализируется типом данных *IProductList* - по умолчанию объект - 

 ```Javascript
 {
    total: 0, // общее количество карточек товаров
    items: []
  }

```

Переменная служит для сохранения информации о выбранных товарах пользователем и их отображения в корзине.

Переменная *itemPreview* - инициализируется типом данных *IProductItem* - по умолчанию значение null. Переменная служит для сохранения отдельной карточки для вывода ее в модалку.

**Конструктор класса:**

Принимает защищенную переменную *events* с типом данных *IEvents*. Тип данных импортируется отдельно. *events* требуется для инициирования событий в методах класса, чтобы подписчики при исполнении событий выполняли определенные действия.


В классе присутствуют такие **методы класса:**

1. **getCards** - метод требуется для отображения на Главной всех карточек товаров. Метод без аргументов. Ожидается, что метод возвращает объект типа *IProductItem[]*, который содержит в себе массив всех карточек с информацией по каждой. 

2. **setCards** - метод требуется для передачи данных от сервера общему классу Model для дальнейшего взаимодействия с полученными данными. Метод сохраняет массив с карточками и кладет в защищенную переменную класса *items*. Аргумент метода *items* типа *IProductItem[]* - массив с информацией о карточках. Неважно, что возвращает метод - *void*. Метод инициирует событие *cards:changed* и передает переменную *items*.

3. **setItemPreview** - метод требуется для отображения одной карточки - в открытой модалке. Аргументом метода выступает *card*, тип данных *IProductItem* - объект со всей информацией по карточке. В методе происходит фильтрация по аргументу и если в общем массиве с карточками находится искомая, то аргумент записывается в переменную *itemPreview*. Обратившись к переменной *itemPreview* можно получить объект с информацией по отдельной карточке. Метод инициирует событие *preview:changed* и передает переменную *itemPreview*.

4. **getTotal** - метод требуется для отображения количества товаров в корзине на Главной странице. Метод без аргументов. Ожидается, что метод вернет количество типа *number* всех товаров в корзине, используя переменную защищенную *items* - использовав базовый метод length.

5. **addToBasket** - метод требуется для добавления карточки в корзину. Аргумент метода *card* типа *IProductItem*. Метод добавляет карточке свойство *selected* в значении true, добавляет переданный аргумент в переменную *basket* и увеличивает значение *total* на стоимость добавленной карточки. Неважно, что возвращает метод - *void*. Метод инициирует событие *basket:changed* и передает переменную *basket*.

6. **removeFromBasket** - метод требуется для удаления карточки из корзины. Аргумент метода *card* типа *IProductItem*. Метод изменяет у переданной карточки свойство *selected* в значение false, а также фильтрует массив *basket* исключая переданную карточку. Неважно, что возвращает метод - *void*.  Метод инициирует событие *basket:changed* и передает переменную *basket*.

7. **clearBasket** - метод требуется для отчищения переменной корзины *basket*, чтобы оставить возможность пользователя делать повторной заказ. В методе отчищаются свойства *items* - [] и *total* - 0 переменной *basket*. Метод без аргументов. Неважно, что возвращает метод - *void*. Метод инициирует событие *basket:changed* и передает переменную *basket*.

8. **validateOrder** - метод требуется для валидации всех полей формы для оформления заказа пользователем. Метод без аргументов. Метод хранит все ошибки и проверяет их исполнение. Неважно, что возвращает метод - *void*.

9. **successOrder** - метод требуется для объединения информации о пользователе и данных из корзины и сохранения в отдельную переменную *order*.


### Описание классов из слоя Presenter

Класс **LarekApi** - расширяет базовый класс **Api**. Класс работает с конкретными типами данных, которые ожидаются от сервера. Типы данных представлены, как в общих типах types/index.ts, так и отдельным интерфейсом *ILarekAPi*.

**Конструктор класса:**

Принимает защищенную переменную *baseUrl* - урл для запросов, с типом данных *string*. 
Второй аргумент - *cdn* - только для чтения, используется как адрес для получения картники карточки - свойсва *image*. *cdn* типизируется как *string*.  
Третий аргумент опциональный *options* - используется для передачи дополнительный данных при запросе к серверу (токен авторизации и проч).

Так как класс расширяет базовый класс **Api** - в конструкторе вызывается базовый конструктор и ему передаются аргементы *baseUrl*, *options*.

Интерфейс *ILarekAPi* типизирует основные методы класса **LarekApi**. К основным **методам** относятся:

1. **getProductList** - метод требуется для получения массива карточек товаров - *items* типа *IProductItem[]* и их общего количества - *total* типа *number*. Используется на Главной странице и в корзине. Метод без аргументов. Ожидается, что метод, используя базовый метод **get** класса **Api**, вернет объект *Promise* с типом данных *<IProductList>*, содержащий массив карточек и их общее количество. После получения информации от сервера, полученный массив преобразуется, в каждый **item** массива добавляется новое свойство **image** с нужным адресом для запроса.

2. **getProductItem** - метод требуется для получения объекта конкретной карточки товара. Используется для различных вариаций отображения карточки, например в классе **Modal** слоя **View**. Аргументом метода является *id* карточки типа *string*. Ожидается, что метод, используя базовый метод **get** класса **Api**, вернет объект карточки *Promise* с типом данных *<IProductItem>*, содержащем информацию о карточке. После получения информации от сервера, полученный объект преобразуется, добавляется новое свойство **image** с нужным адресом для запроса.

3. **postOrder** - метод требуется для отправки на сервер заказа конкретного пользователя со всеми данными как о заказа, так и о введенной информации пользователя. Используется при отображении финального экрана об успешной покупке в слое **View** класса **Modal**. Аргументом метода является объект *data* - содержит всю информацию о помещенных в корзину карточках, а также инфориации пользователя типа *IOrder*. Ожидается, что метод, используя базовый метод **post** класса **Api**, вернет объект *Promise* с типом данных *ISuccessfulOrder*, содержащий *id* типа *string* сформированного заказа и общую сумму покупки *total* типа *number*.


### Описание классов из слоя View

Все классы слоя наследуют от базового класса **Component** содержащего основные методы работы с разметкой.

1. Класс **Form** - принимает любую форму типа *HtmlFormElement* и проверяет валидность полей. На основании валидации, показывает ошибки и блокирует кнопку.

**Переменные класса:**

Все переменные класса защищенные - *protected*, поэтому взаимодействие с переменными может быть лишь опосредованным через методы класса, описанные ниже.

**Конструктор класса:**

**Методы класса:**


_____


2. Класс **Modal** - требуется для отображения модальных окон, которые содержат в себе информацию в виде, форм, карточек и тд. Класс отвечает только за рендер, открытие и закрытие конкретно контейнера - модалки. Класс типизирован интерфейсом *IModalData*. Класс расширяет базовый класс **Component** передавая тому интерфейс *IModalData* - объект содержащий свойство *data* в виде *HtmlElement*. *data* - контент, который будет рендериться внутри модалки.

**Переменные класса:**

Все переменные класса защищенные - *protected*, поэтому взаимодействие с переменными может быть лишь опосредованным через методы класса, описанные ниже.

*buttonClose* инициализируется типом данных *HTMLButtonElement*. Элемент разметки в виде кнопки закрытия модалки. Ее поиск происходит в контейнере, который принимает конструктор класса.

*content* инициализируется типом данных *HTMLElement*. Элемент разметки в виде *div*, который в будущем будет содержать весь получаемый контент для модалки. Ее поиск происходит в контейнере, который принимает конструктор класса.

**Конструктор класса:**

Принимает *container* - разметка модального окна, типа *HTMLElement*. В *container* будет происходить поиск всех элементов и в него будет рендериться контент модального окна.
Второй аргумент защищенная переменная *events* с типом данных *IEvents*. При открытии и закрытии модалки должны передаваться события, в которых будет происходить обработка страницы с целью блокировки скролла.

Конструктор содержит обработчик по клику на кнопку закрытия модалки - должно закрываться модальное окно.

**Методы класса:**

1. сеттер **data** - метод требуется для заполнения контента в модалке. Аргумент метода *cardInfo* - контейнер с заполненной разметкой карточки типа *HTMLElement*. Метод вставляет всю разметку в переменную *content*.

2. **open** - метод требуется для открытия модального окна. Чтобы модалка открылась, требуется добавить специальный класс переменной *container*. Метод без аргументов. Также в методе инициализируется событие, которые говорит об открытии модалки.

3. **close** - метод требуется для закрытия модального окна. Метод без аргументов. Ожидается, что метод будет убирать специальный класс у переменной *container*. Также в методе инициализируется событие, которые говорит о закрытии модалки.

4. **render** - метод требуется для рендера контента в модальном окне. Аргументом метод принимает *data* - объект с разметкой типа *IModalData*. Метод вызовет родительский *render*, откроет модалку и вернет *container*.

_____


3. Класс **Page** - требуется для представления информации на Главной странице. Отображает отдельно отрендеренные карточки в виде каталога, а также счетчик корзины. Класс типизирован интерфейсом *IPage*. Класс расширяет **Component** передавая тому *IPage* - объект с двумя свойствами: *counter* - общее количество карточек, *catalog* - *HTMLElement[]* - массив с разметкой карточек. 

**Переменные класса:**

Все переменные класса защищенные - *protected*, поэтому взаимодействие с переменными может быть лишь опосредованным через методы класса, описанные ниже.

Все переменные являются типом *HTMLElement* и фактически содержат в себе разметку того или иного элемента, который отображается на Главной странице. Переменные:

*basketCounter* - счетчик товаров в корзине

*gallery* - контейнер, который будет получать массив карточек и отображать его

*basket* - элемент корзина - при клике будет открываться содержимое корзины

*wrapper* - затемняющая прослойка для модалки. Нужна для блокирования скролла страницы, при открытии модалок

**Конструктор класса:**

Принимает защищенную переменную *events* с типом данных *IEvents*. Тип данных импортируется отдельно. *events* требуется для инициирования событий в методах класса, чтобы подписчики при исполнении событий выполняли определенные действия. Второй аргумент конструктора *documentBody* - контейнер в котором будет поиск элементов, а также вывод в них информации.

Родительскому классу передается *documentBody*.

**Методы класса:**

Методы представляют собой сеттеры *counter*, *catalog*, *pageWrapperLocked*. 

Сеттер **counter** - требуется для вставки информации в элемент разметки отвечающий за счетчик товаров в корзине. Аргументом метода является *value* типа *number*. 

Сеттер **catalog** - требуется для вставки информации в элемент разметки отвечающий за показ всех товаров в корзине. Аргументом метода является *items* типа *HTMLElement[]*.

Сеттер **pageWrapperLocked** - требуется для блокировки скролла страницы при открытии модалки, а также разблокировки при закрытии модалки. Арггумент метода *value* типа *boolean*. Метод использует базовую утилиту по переключению класса, таким образом скрывая/показывая скролл.

_____


4. Класс **Basket** - требуется для представления корзины. Корзина должна принимать массив с карточками товаров, а также общую стоимость товаров. Класс типизирован *IBasket*.

**Переменные класса:**

Все переменные класса защищенные - *protected*, поэтому взаимодействие с переменными может быть лишь опосредованным через методы класса, описанные ниже.

**Конструктор класса:**

**Методы класса:**

_____


5. Класс **SuccessOrder** - требуется для представления информации на завершающем экране покупки. После совершения всех действий пользователем по покупке карточек товаров, требуется вывести модалку с информацией об общей стоимости покупки, а также кнопку, которая будет закрывать модалку. Класс типизирован интерфейсом *ISuccessOrder*. 

**Переменные класса:**

Все переменные класса защищенные - *protected*, поэтому взаимодействие с переменными может быть лишь опосредованным через методы класса, описанные ниже.

Все переменные являются типом *HTMLElement* и фактически содержат в себе разметку того или иного элемента, который отображается в модалке. Переменные:

*successDescription* 

*closeButton*

**Конструктор класса:**

Принимает защищенную переменную *container* с типом данных *HTMLElement* - контейнер в котором будет поиск элементов, а также вывод в них информации. Второй аргумент конструктора *action* типизирован интерфейсом *ICloseModal* - если будет передана функция в переменную *action*, то будет повешен обработчик на кнопку. При клике на кнопку должна закрываться модалка.

**Методы класса:**

Представлен единственный метод - сеттер *total*, который будет устанавливать нужное значение в переменную и таким образом выводить общее количество потраченных синапсов. Аргументом метода является *value* типа *number*. Ожидается, что метод будет использовать родительский метод *setText* подставляя значение *value*. 

_____


6. Класс **Card** - требуется для отображения конкретной карточки. Будет использован как для рендера основой страницы, так и для наполнения модалки и корзины. Класс типизирован интерфейсом *IOpenPrewiev* - это объект, который содержит функцию, которая принмает *event* типа *MouseEvent*. Типизация требуется для выполнения опредленного действия при клике на карточку , например открытия модалки с данной карточкой. Класс расширяет базовый класс **Component** и передает тому объект типа *IProductItem*.

**Переменные класса:**

Все переменные класса защищенные - *protected*, поэтому взаимодействие с переменными может быть лишь опосредованным через методы класса, описанные ниже.

Обязательных переменных всего две и связано это с тем, что класс будет работать с любым отображением карточки (с описанием и без, с категорией и без и тд). 

*cardTitle* - инициализируется типом *HTMLElement*. Элемент разметки, содержащий название карточки. Ее поиск происходит в контейнере, который принимает конструктор класса.

*cardPrice* - инициализируется типом *HTMLElement*. Элемент разметки, содержащий стоимость карточки. Ее поиск происходит в контейнере, который принимает конструктор класса.

Далее будут перечислены опциональные переменные.

*cardDescription* - инициализируется типом *HTMLElement*. Элемент разметки, содержащий описание карточки. Ее поиск происходит в контейнере, который принимает конструктор класса.

*cardImage* - инициализируется типом *HTMLImageElement*. Элемент разметки, содержащий изображение карточки. Ее поиск происходит в контейнере, который принимает конструктор класса.

*cardCategory* - инициализируется типом *HTMLElement*. Элемент разметки, содержащий название категории карточки. Ее поиск происходит в контейнере, который принимает конструктор класса.

*cardButton* - инициализируется типом *HTMLButtonElement*. Элемент разметки, содержащий название кнопки карточки. Ее поиск происходит в контейнере, который принимает конструктор класса.

*cardId* - инициализируется типом *string*. Это id карточки.

**Конструктор класса:**

Принимает переменную *container* с типом данных *HTMLElement* - контейнер в котором будет поиск элементов, а также вывод в них информации. Второй аргумент конструктора опциональный *action* типизирован интерфейсом *IOpenPrewiev* - если будет передана функция в переменную *action*, то будет повешен обработчик на кнопку.

Родительскому классу передается *container*.

В конструкторе навешивается передаваемый аргументом обработчик на *container*, например по клику на карточку, должен заполняться темплейт с карточкой для модалки.

**Методы класса:**

1. сеттер **description** - метод требуется для заполнения в *container* описания карточки. Аргумент метода *text* типа *string*.

2. сеттер **image** - метод требуется для заполнения в *container* изображения карточки. Аргумент метода *img* типа *string*.

3. геттер **title** - метод требуется для получения из *container* названия карточки. Метод без аргументов.

4. сеттер **title** - метод требуется для заполнения в *container* названия карточки. Аргумент метода *text* типа *string*.

5. сеттер **category** - метод требуется для заполнения в *container* названия категории карточки. Аргумент метода *text* типа *string*.

6. сеттер **price** - метод требуется для заполнения в *container* стоимости карточки. Аргумент метода *value* типа *number*.

7. сеттер **button** - метод требуется для заполнения в *container* названия кнопки карточки. Аргумент метода *text* типа *string*.

8. сеттер **id** - метод требуется для заполнения в *id* id карточки. Аргумент метода *id* типа *string*.

 _____


#### Состояния приложения(событийная модель)

*cards:changed* - вызывается при изменении списка карточек на Главной

*basket:changed* - вызывается при изменении количества товаров в корзине

*basket:open* - вызывается при открытии корзины

*modal:open* - вызывается при выборе карточки и открытии ее модалки

*modal:close* - вызывается при закрытии модалки карточки

*preview:changed* - изменение контента в модалке

*order:selected* - вызывается при нажатии в корзину в модалке карточки

*order:unselected* - вызывается при нажатии Убрать из корзины в модалке карточки

*orderInfo:open* - вызывается при нажатии Оформить в корзине

*orderInfo:changed* - вызывается при нажатии Далее в форме заполнения информации пользователем. Включает в себя валидацию полей

*order:success* - вызывается при нажатии на Оплатить на последнем экране формы при отправке всех данных о заказе на сервер.

*order:new* - вызывается вслед за *order:success* и отчищает корзину